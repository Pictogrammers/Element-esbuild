#!/usr/bin/env node
import { createRequire } from 'node:module'; const require = createRequire(import.meta.url);
import{context as es}from"esbuild";import{EventEmitter as Ce}from"node:events";import{stat as ve}from"node:fs";import{readdir as Ie,stat as $e}from"node:fs/promises";import*as m from"node:path";import{lstat as yt,readdir as Jt,realpath as Xt,stat as Qt}from"node:fs/promises";import{join as te,relative as ee,resolve as Et,sep as se}from"node:path";import{Readable as ie}from"node:stream";var A={FILE_TYPE:"files",DIR_TYPE:"directories",FILE_DIR_TYPE:"files_directories",EVERYTHING_TYPE:"all"},nt={root:".",fileFilter:i=>!0,directoryFilter:i=>!0,type:A.FILE_TYPE,lstat:!1,depth:2147483648,alwaysStat:!1,highWaterMark:4096};Object.freeze(nt);var Dt="READDIRP_RECURSIVE_ERROR",ne=new Set(["ENOENT","EPERM","EACCES","ELOOP",Dt]),Pt=[A.DIR_TYPE,A.EVERYTHING_TYPE,A.FILE_DIR_TYPE,A.FILE_TYPE],re=new Set([A.DIR_TYPE,A.EVERYTHING_TYPE,A.FILE_DIR_TYPE]),oe=new Set([A.EVERYTHING_TYPE,A.FILE_DIR_TYPE,A.FILE_TYPE]),ae=i=>ne.has(i.code),ce=process.platform==="win32",xt=i=>!0,bt=i=>{if(i===void 0)return xt;if(typeof i=="function")return i;if(typeof i=="string"){let t=i.trim();return e=>e.basename===t}if(Array.isArray(i)){let t=i.map(e=>e.trim());return e=>t.some(n=>e.basename===n)}return xt},rt=class extends ie{parents;reading;parent;_stat;_maxDepth;_wantsDir;_wantsFile;_wantsEverything;_root;_isDirent;_statsProp;_rdOptions;_fileFilter;_directoryFilter;constructor(t={}){super({objectMode:!0,autoDestroy:!0,highWaterMark:t.highWaterMark});let e={...nt,...t},{root:n,type:s}=e;this._fileFilter=bt(e.fileFilter),this._directoryFilter=bt(e.directoryFilter);let a=e.lstat?yt:Qt;ce?this._stat=c=>a(c,{bigint:!0}):this._stat=a,this._maxDepth=e.depth!=null&&Number.isSafeInteger(e.depth)?e.depth:nt.depth,this._wantsDir=s?re.has(s):!1,this._wantsFile=s?oe.has(s):!1,this._wantsEverything=s===A.EVERYTHING_TYPE,this._root=Et(n),this._isDirent=!e.alwaysStat,this._statsProp=this._isDirent?"dirent":"stats",this._rdOptions={encoding:"utf8",withFileTypes:this._isDirent},this.parents=[this._exploreDir(n,1)],this.reading=!1,this.parent=void 0}async _read(t){if(!this.reading){this.reading=!0;try{for(;!this.destroyed&&t>0;){let e=this.parent,n=e&&e.files;if(n&&n.length>0){let{path:s,depth:a}=e,c=n.splice(0,t).map(r=>this._formatEntry(r,s)),o=await Promise.all(c);for(let r of o){if(!r)continue;if(this.destroyed)return;let d=await this._getEntryType(r);d==="directory"&&this._directoryFilter(r)?(a<=this._maxDepth&&this.parents.push(this._exploreDir(r.fullPath,a+1)),this._wantsDir&&(this.push(r),t--)):(d==="file"||this._includeAsFile(r))&&this._fileFilter(r)&&this._wantsFile&&(this.push(r),t--)}}else{let s=this.parents.pop();if(!s){this.push(null);break}if(this.parent=await s,this.destroyed)return}}}catch(e){this.destroy(e)}finally{this.reading=!1}}}async _exploreDir(t,e){let n;try{n=await Jt(t,this._rdOptions)}catch(s){this._onError(s)}return{files:n,depth:e,path:t}}async _formatEntry(t,e){let n,s=this._isDirent?t.name:t;try{let a=Et(te(e,s));n={path:ee(this._root,a),fullPath:a,basename:s},n[this._statsProp]=this._isDirent?t:await this._stat(a)}catch(a){this._onError(a);return}return n}_onError(t){ae(t)&&!this.destroyed?this.emit("warn",t):this.destroy(t)}async _getEntryType(t){if(!t&&this._statsProp in t)return"";let e=t[this._statsProp];if(e.isFile())return"file";if(e.isDirectory())return"directory";if(e&&e.isSymbolicLink()){let n=t.fullPath;try{let s=await Xt(n),a=await yt(s);if(a.isFile())return"file";if(a.isDirectory()){let c=s.length;if(n.startsWith(s)&&n.substr(c,1)===se){let o=new Error(`Circular symlink detected: "${n}" points to "${s}"`);return o.code=Dt,this._onError(o)}return"directory"}}catch(s){return this._onError(s),""}}}_includeAsFile(t){let e=t&&t[this._statsProp];return e&&this._wantsEverything&&!e.isDirectory()}};function Rt(i,t={}){let e=t.entryType||t.type;if(e==="both"&&(e=A.FILE_DIR_TYPE),e&&(t.type=e),i){if(typeof i!="string")throw new TypeError("readdirp: root argument must be a string. Usage: readdirp(root, options)");if(e&&!Pt.includes(e))throw new Error(`readdirp: Invalid type passed. Use one of ${Pt.join(", ")}`)}else throw new Error("readdirp: root argument is required. Usage: readdirp(root, options)");return t.root=i,new rt(t)}import{watch as le,unwatchFile as Ct,watchFile as he}from"node:fs";import{realpath as ot,lstat as fe,open as de,stat as It}from"node:fs/promises";import{type as pe}from"node:os";import*as x from"node:path";var ue="data",lt="end",$t="close",q=()=>{};var J=process.platform,ht=J==="win32",me=J==="darwin",_e=J==="linux",we=J==="freebsd",Tt=pe()==="OS400",D={ALL:"all",READY:"ready",ADD:"add",CHANGE:"change",ADD_DIR:"addDir",UNLINK:"unlink",UNLINK_DIR:"unlinkDir",RAW:"raw",ERROR:"error"},N=D,ge="watch",ye={lstat:fe,stat:It},k="listeners",V="errHandlers",z="rawEmitters",Ee=[k,V,z],Pe=new Set(["3dm","3ds","3g2","3gp","7z","a","aac","adp","afdesign","afphoto","afpub","ai","aif","aiff","alz","ape","apk","appimage","ar","arj","asf","au","avi","bak","baml","bh","bin","bk","bmp","btif","bz2","bzip2","cab","caf","cgm","class","cmx","cpio","cr2","cur","dat","dcm","deb","dex","djvu","dll","dmg","dng","doc","docm","docx","dot","dotm","dra","DS_Store","dsk","dts","dtshd","dvb","dwg","dxf","ecelp4800","ecelp7470","ecelp9600","egg","eol","eot","epub","exe","f4v","fbs","fh","fla","flac","flatpak","fli","flv","fpx","fst","fvt","g3","gh","gif","graffle","gz","gzip","h261","h263","h264","icns","ico","ief","img","ipa","iso","jar","jpeg","jpg","jpgv","jpm","jxr","key","ktx","lha","lib","lvp","lz","lzh","lzma","lzo","m3u","m4a","m4v","mar","mdi","mht","mid","midi","mj2","mka","mkv","mmr","mng","mobi","mov","movie","mp3","mp4","mp4a","mpeg","mpg","mpga","mxu","nef","npx","numbers","nupkg","o","odp","ods","odt","oga","ogg","ogv","otf","ott","pages","pbm","pcx","pdb","pdf","pea","pgm","pic","png","pnm","pot","potm","potx","ppa","ppam","ppm","pps","ppsm","ppsx","ppt","pptm","pptx","psd","pya","pyc","pyo","pyv","qt","rar","ras","raw","resources","rgb","rip","rlc","rmf","rmvb","rpm","rtf","rz","s3m","s7z","scpt","sgi","shar","snap","sil","sketch","slk","smv","snk","so","stl","suo","sub","swf","tar","tbz","tbz2","tga","tgz","thmx","tif","tiff","tlz","ttc","ttf","txz","udf","uvh","uvi","uvm","uvp","uvs","uvu","viv","vob","war","wav","wax","wbmp","wdp","weba","webm","webp","whl","wim","wm","wma","wmv","wmx","woff","woff2","wrm","wvx","xbm","xif","xla","xlam","xls","xlsb","xlsm","xlsx","xlt","xltm","xltx","xm","xmind","xpi","xpm","xwd","xz","z","zip","zipx"]),xe=i=>Pe.has(x.extname(i).slice(1).toLowerCase()),ct=(i,t)=>{i instanceof Set?i.forEach(t):t(i)},Y=(i,t,e)=>{let n=i[t];n instanceof Set||(i[t]=n=new Set([n])),n.add(e)},be=i=>t=>{let e=i[t];e instanceof Set?e.clear():delete i[t]},U=(i,t,e)=>{let n=i[t];n instanceof Set?n.delete(e):n===e&&delete i[t]},At=i=>i instanceof Set?i.size===0:!i,B=new Map;function vt(i,t,e,n,s){let a=(c,o)=>{e(i),s(c,o,{watchedPath:i}),o&&i!==o&&K(x.resolve(i,o),k,x.join(i,o))};try{return le(i,{persistent:t.persistent},a)}catch(c){n(c);return}}var K=(i,t,e,n,s)=>{let a=B.get(i);a&&ct(a[t],c=>{c(e,n,s)})},De=(i,t,e,n)=>{let{listener:s,errHandler:a,rawEmitter:c}=n,o=B.get(t),r;if(!e.persistent)return r=vt(i,e,s,a,c),r?r.close.bind(r):void 0;if(o)Y(o,k,s),Y(o,V,a),Y(o,z,c);else{if(r=vt(i,e,K.bind(null,t,k),a,K.bind(null,t,z)),!r)return;r.on(N.ERROR,async d=>{let f=K.bind(null,t,V);if(o&&(o.watcherUnusable=!0),ht&&d.code==="EPERM")try{await(await de(i,"r")).close(),f(d)}catch{}else f(d)}),o={listeners:s,errHandlers:a,rawEmitters:c,watcher:r},B.set(t,o)}return()=>{U(o,k,s),U(o,V,a),U(o,z,c),At(o.listeners)&&(o.watcher.close(),B.delete(t),Ee.forEach(be(o)),o.watcher=void 0,Object.freeze(o))}},at=new Map,Re=(i,t,e,n)=>{let{listener:s,rawEmitter:a}=n,c=at.get(t),o=c&&c.options;return o&&(o.persistent<e.persistent||o.interval>e.interval)&&(Ct(t),c=void 0),c?(Y(c,k,s),Y(c,z,a)):(c={listeners:s,rawEmitters:a,options:e,watcher:he(t,e,(r,d)=>{ct(c.rawEmitters,h=>{h(N.CHANGE,t,{curr:r,prev:d})});let f=r.mtimeMs;(r.size!==d.size||f>d.mtimeMs||f===0)&&ct(c.listeners,h=>h(i,r))})},at.set(t,c)),()=>{U(c,k,s),U(c,z,a),At(c.listeners)&&(at.delete(t),Ct(t),c.options=c.watcher=void 0,Object.freeze(c))}},Z=class{fsw;_boundHandleError;constructor(t){this.fsw=t,this._boundHandleError=e=>t._handleError(e)}_watchWithNodeFs(t,e){let n=this.fsw.options,s=x.dirname(t),a=x.basename(t);this.fsw._getWatchedDir(s).add(a);let o=x.resolve(t),r={persistent:n.persistent};e||(e=q);let d;if(n.usePolling){let f=n.interval!==n.binaryInterval;r.interval=f&&xe(a)?n.binaryInterval:n.interval,d=Re(t,o,r,{listener:e,rawEmitter:this.fsw._emitRaw})}else d=De(t,o,r,{listener:e,errHandler:this._boundHandleError,rawEmitter:this.fsw._emitRaw});return d}_handleFile(t,e,n){if(this.fsw.closed)return;let s=x.dirname(t),a=x.basename(t),c=this.fsw._getWatchedDir(s),o=e;if(c.has(a))return;let r=async(f,h)=>{if(this.fsw._throttle(ge,t,5)){if(!h||h.mtimeMs===0)try{let l=await It(t);if(this.fsw.closed)return;let p=l.atimeMs,u=l.mtimeMs;if((!p||p<=u||u!==o.mtimeMs)&&this.fsw._emit(N.CHANGE,t,l),(me||_e||we)&&o.ino!==l.ino){this.fsw._closeFile(f),o=l;let g=this._watchWithNodeFs(t,r);g&&this.fsw._addPathCloser(f,g)}else o=l}catch{this.fsw._remove(s,a)}else if(c.has(a)){let l=h.atimeMs,p=h.mtimeMs;(!l||l<=p||p!==o.mtimeMs)&&this.fsw._emit(N.CHANGE,t,h),o=h}}},d=this._watchWithNodeFs(t,r);if(!(n&&this.fsw.options.ignoreInitial)&&this.fsw._isntIgnored(t)){if(!this.fsw._throttle(N.ADD,t,0))return;this.fsw._emit(N.ADD,t,e)}return d}async _handleSymlink(t,e,n,s){if(this.fsw.closed)return;let a=t.fullPath,c=this.fsw._getWatchedDir(e);if(!this.fsw.options.followSymlinks){this.fsw._incrReadyCount();let o;try{o=await ot(n)}catch{return this.fsw._emitReady(),!0}return this.fsw.closed?void 0:(c.has(s)?this.fsw._symlinkPaths.get(a)!==o&&(this.fsw._symlinkPaths.set(a,o),this.fsw._emit(N.CHANGE,n,t.stats)):(c.add(s),this.fsw._symlinkPaths.set(a,o),this.fsw._emit(N.ADD,n,t.stats)),this.fsw._emitReady(),!0)}if(this.fsw._symlinkPaths.has(a))return!0;this.fsw._symlinkPaths.set(a,!0)}_handleRead(t,e,n,s,a,c,o){t=x.join(t,"");let r=s?`${t}:${s}`:t;if(o=this.fsw._throttle("readdir",r,1e3),!o)return;let d=this.fsw._getWatchedDir(n.path),f=new Set,h=this.fsw._readdirp(t,{fileFilter:l=>n.filterPath(l),directoryFilter:l=>n.filterDir(l)});if(h)return h.on(ue,async l=>{if(this.fsw.closed){h=void 0;return}let p=l.path,u=x.join(t,p);if(f.add(p),!(l.stats.isSymbolicLink()&&await this._handleSymlink(l,t,u,p))){if(this.fsw.closed){h=void 0;return}(p===s||!s&&!d.has(p))&&(this.fsw._incrReadyCount(),u=x.join(a,x.relative(a,u)),this._addToNodeFs(u,e,n,c+1))}}).on(N.ERROR,this._boundHandleError),new Promise((l,p)=>{if(!h)return p();h.once(lt,()=>{if(this.fsw.closed){h=void 0;return}let u=o?o.clear():!1;l(void 0),d.getChildren().filter(g=>g!==t&&!f.has(g)).forEach(g=>{this.fsw._remove(t,g)}),h=void 0,u&&this._handleRead(t,!1,n,s,a,c,o)})})}async _handleDir(t,e,n,s,a,c,o){let r=this.fsw._getWatchedDir(x.dirname(t)),d=r.has(x.basename(t));!(n&&this.fsw.options.ignoreInitial)&&!a&&!d&&this.fsw._emit(N.ADD_DIR,t,e),r.add(x.basename(t)),this.fsw._getWatchedDir(t);let f,h,l=this.fsw.options.depth;if((l==null||s<=l)&&!this.fsw._symlinkPaths.has(o)){if(!a&&(await this._handleRead(t,n,c,a,t,s,f),this.fsw.closed))return;h=this._watchWithNodeFs(t,(p,u)=>{u&&u.mtimeMs===0||this._handleRead(p,!1,c,a,t,s,f)})}return h}async _addToNodeFs(t,e,n,s,a){let c=this.fsw._emitReady;if(this.fsw._isIgnored(t)||this.fsw.closed)return c(),!1;let o=this.fsw._getWatchHelpers(t);n&&(o.filterPath=r=>n.filterPath(r),o.filterDir=r=>n.filterDir(r));try{let r=await ye[o.statMethod](o.watchPath);if(this.fsw.closed)return;if(this.fsw._isIgnored(o.watchPath,r))return c(),!1;let d=this.fsw.options.followSymlinks,f;if(r.isDirectory()){let h=x.resolve(t),l=d?await ot(t):t;if(this.fsw.closed||(f=await this._handleDir(o.watchPath,r,e,s,a,o,l),this.fsw.closed))return;h!==l&&l!==void 0&&this.fsw._symlinkPaths.set(h,l)}else if(r.isSymbolicLink()){let h=d?await ot(t):t;if(this.fsw.closed)return;let l=x.dirname(o.watchPath);if(this.fsw._getWatchedDir(l).add(o.watchPath),this.fsw._emit(N.ADD,o.watchPath,r),f=await this._handleDir(l,r,e,s,t,o,h),this.fsw.closed)return;h!==void 0&&this.fsw._symlinkPaths.set(x.resolve(t),h)}else f=this._handleFile(o.watchPath,r,e);return c(),f&&this.fsw._addPathCloser(t,f),!1}catch(r){if(this.fsw._handleError(r))return c(),t}}};var ft="/",Te="//",Wt=".",Ae="..",Fe="string",Ne=/\\/g,kt=/\/\//g,Se=/\..*\.(sw[px])$|~$|\.subl.*\.tmp/,Me=/^\.[/\\]/;function X(i){return Array.isArray(i)?i:[i]}var dt=i=>typeof i=="object"&&i!==null&&!(i instanceof RegExp);function We(i){return typeof i=="function"?i:typeof i=="string"?t=>i===t:i instanceof RegExp?t=>i.test(t):typeof i=="object"&&i!==null?t=>{if(i.path===t)return!0;if(i.recursive){let e=m.relative(i.path,t);return e?!e.startsWith("..")&&!m.isAbsolute(e):!1}return!1}:()=>!1}function ke(i){if(typeof i!="string")throw new Error("string expected");i=m.normalize(i),i=i.replace(/\\/g,"/");let t=!1;return i.startsWith("//")&&(t=!0),i=i.replace(kt,"/"),t&&(i="/"+i),i}function Ft(i,t,e){let n=ke(t);for(let s=0;s<i.length;s++){let a=i[s];if(a(n,e))return!0}return!1}function Le(i,t){if(i==null)throw new TypeError("anymatch: specify first argument");let n=X(i).map(s=>We(s));return t==null?(s,a)=>Ft(n,s,a):Ft(n,t)}var Nt=i=>{let t=X(i).flat();if(!t.every(e=>typeof e===Fe))throw new TypeError(`Non-string provided as watch path: ${t}`);return t.map(Lt)},St=i=>{let t=i.replace(Ne,ft),e=!1;return t.startsWith(Te)&&(e=!0),t=t.replace(kt,ft),e&&(t=ft+t),t},Lt=i=>St(m.normalize(St(i))),Mt=(i="")=>t=>typeof t=="string"?Lt(m.isAbsolute(t)?t:m.join(i,t)):t,je=(i,t)=>m.isAbsolute(i)?i:m.join(t,i),Oe=Object.freeze(new Set),pt=class{path;_removeWatcher;items;constructor(t,e){this.path=t,this._removeWatcher=e,this.items=new Set}add(t){let{items:e}=this;e&&t!==Wt&&t!==Ae&&e.add(t)}async remove(t){let{items:e}=this;if(!e||(e.delete(t),e.size>0))return;let n=this.path;try{await Ie(n)}catch{this._removeWatcher&&this._removeWatcher(m.dirname(n),m.basename(n))}}has(t){let{items:e}=this;if(e)return e.has(t)}getChildren(){let{items:t}=this;return t?[...t.values()]:[]}dispose(){this.items.clear(),this.path="",this._removeWatcher=q,this.items=Oe,Object.freeze(this)}},ze="stat",He="lstat",ut=class{fsw;path;watchPath;fullWatchPath;dirParts;followSymlinks;statMethod;constructor(t,e,n){this.fsw=n;let s=t;this.path=t=t.replace(Me,""),this.watchPath=s,this.fullWatchPath=m.resolve(s),this.dirParts=[],this.dirParts.forEach(a=>{a.length>1&&a.pop()}),this.followSymlinks=e,this.statMethod=e?ze:He}entryPath(t){return m.join(this.watchPath,m.relative(this.watchPath,t.fullPath))}filterPath(t){let{stats:e}=t;if(e&&e.isSymbolicLink())return this.filterDir(t);let n=this.entryPath(t);return this.fsw._isntIgnored(n,e)&&this.fsw._hasReadPermissions(e)}filterDir(t){return this.fsw._isntIgnored(this.entryPath(t),t.stats)}},Q=class extends Ce{closed;options;_closers;_ignoredPaths;_throttled;_streams;_symlinkPaths;_watched;_pendingWrites;_pendingUnlinks;_readyCount;_emitReady;_closePromise;_userIgnored;_readyEmitted;_emitRaw;_boundRemove;_nodeFsHandler;constructor(t={}){super(),this.closed=!1,this._closers=new Map,this._ignoredPaths=new Set,this._throttled=new Map,this._streams=new Set,this._symlinkPaths=new Map,this._watched=new Map,this._pendingWrites=new Map,this._pendingUnlinks=new Map,this._readyCount=0,this._readyEmitted=!1;let e=t.awaitWriteFinish,n={stabilityThreshold:2e3,pollInterval:100},s={persistent:!0,ignoreInitial:!1,ignorePermissionErrors:!1,interval:100,binaryInterval:300,followSymlinks:!0,usePolling:!1,atomic:!0,...t,ignored:t.ignored?X(t.ignored):X([]),awaitWriteFinish:e===!0?n:typeof e=="object"?{...n,...e}:!1};Tt&&(s.usePolling=!0),s.atomic===void 0&&(s.atomic=!s.usePolling);let a=process.env.CHOKIDAR_USEPOLLING;if(a!==void 0){let r=a.toLowerCase();r==="false"||r==="0"?s.usePolling=!1:r==="true"||r==="1"?s.usePolling=!0:s.usePolling=!!r}let c=process.env.CHOKIDAR_INTERVAL;c&&(s.interval=Number.parseInt(c,10));let o=0;this._emitReady=()=>{o++,o>=this._readyCount&&(this._emitReady=q,this._readyEmitted=!0,process.nextTick(()=>this.emit(D.READY)))},this._emitRaw=(...r)=>this.emit(D.RAW,...r),this._boundRemove=this._remove.bind(this),this.options=s,this._nodeFsHandler=new Z(this),Object.freeze(s)}_addIgnoredPath(t){if(dt(t)){for(let e of this._ignoredPaths)if(dt(e)&&e.path===t.path&&e.recursive===t.recursive)return}this._ignoredPaths.add(t)}_removeIgnoredPath(t){if(this._ignoredPaths.delete(t),typeof t=="string")for(let e of this._ignoredPaths)dt(e)&&e.path===t&&this._ignoredPaths.delete(e)}add(t,e,n){let{cwd:s}=this.options;this.closed=!1,this._closePromise=void 0;let a=Nt(t);return s&&(a=a.map(c=>je(c,s))),a.forEach(c=>{this._removeIgnoredPath(c)}),this._userIgnored=void 0,this._readyCount||(this._readyCount=0),this._readyCount+=a.length,Promise.all(a.map(async c=>{let o=await this._nodeFsHandler._addToNodeFs(c,!n,void 0,0,e);return o&&this._emitReady(),o})).then(c=>{this.closed||c.forEach(o=>{o&&this.add(m.dirname(o),m.basename(e||o))})}),this}unwatch(t){if(this.closed)return this;let e=Nt(t),{cwd:n}=this.options;return e.forEach(s=>{!m.isAbsolute(s)&&!this._closers.has(s)&&(n&&(s=m.join(n,s)),s=m.resolve(s)),this._closePath(s),this._addIgnoredPath(s),this._watched.has(s)&&this._addIgnoredPath({path:s,recursive:!0}),this._userIgnored=void 0}),this}close(){if(this._closePromise)return this._closePromise;this.closed=!0,this.removeAllListeners();let t=[];return this._closers.forEach(e=>e.forEach(n=>{let s=n();s instanceof Promise&&t.push(s)})),this._streams.forEach(e=>e.destroy()),this._userIgnored=void 0,this._readyCount=0,this._readyEmitted=!1,this._watched.forEach(e=>e.dispose()),this._closers.clear(),this._watched.clear(),this._streams.clear(),this._symlinkPaths.clear(),this._throttled.clear(),this._closePromise=t.length?Promise.all(t).then(()=>{}):Promise.resolve(),this._closePromise}getWatched(){let t={};return this._watched.forEach((e,n)=>{let a=(this.options.cwd?m.relative(this.options.cwd,n):n)||Wt;t[a]=e.getChildren().sort()}),t}emitWithAll(t,e){this.emit(t,...e),t!==D.ERROR&&this.emit(D.ALL,t,...e)}async _emit(t,e,n){if(this.closed)return;let s=this.options;ht&&(e=m.normalize(e)),s.cwd&&(e=m.relative(s.cwd,e));let a=[e];n!=null&&a.push(n);let c=s.awaitWriteFinish,o;if(c&&(o=this._pendingWrites.get(e)))return o.lastChange=new Date,this;if(s.atomic){if(t===D.UNLINK)return this._pendingUnlinks.set(e,[t,...a]),setTimeout(()=>{this._pendingUnlinks.forEach((r,d)=>{this.emit(...r),this.emit(D.ALL,...r),this._pendingUnlinks.delete(d)})},typeof s.atomic=="number"?s.atomic:100),this;t===D.ADD&&this._pendingUnlinks.has(e)&&(t=D.CHANGE,this._pendingUnlinks.delete(e))}if(c&&(t===D.ADD||t===D.CHANGE)&&this._readyEmitted){let r=(d,f)=>{d?(t=D.ERROR,a[0]=d,this.emitWithAll(t,a)):f&&(a.length>1?a[1]=f:a.push(f),this.emitWithAll(t,a))};return this._awaitWriteFinish(e,c.stabilityThreshold,t,r),this}if(t===D.CHANGE&&!this._throttle(D.CHANGE,e,50))return this;if(s.alwaysStat&&n===void 0&&(t===D.ADD||t===D.ADD_DIR||t===D.CHANGE)){let r=s.cwd?m.join(s.cwd,e):e,d;try{d=await $e(r)}catch{}if(!d||this.closed)return;a.push(d)}return this.emitWithAll(t,a),this}_handleError(t){let e=t&&t.code;return t&&e!=="ENOENT"&&e!=="ENOTDIR"&&(!this.options.ignorePermissionErrors||e!=="EPERM"&&e!=="EACCES")&&this.emit(D.ERROR,t),t||this.closed}_throttle(t,e,n){this._throttled.has(t)||this._throttled.set(t,new Map);let s=this._throttled.get(t);if(!s)throw new Error("invalid throttle");let a=s.get(e);if(a)return a.count++,!1;let c,o=()=>{let d=s.get(e),f=d?d.count:0;return s.delete(e),clearTimeout(c),d&&clearTimeout(d.timeoutObject),f};c=setTimeout(o,n);let r={timeoutObject:c,clear:o,count:0};return s.set(e,r),r}_incrReadyCount(){return this._readyCount++}_awaitWriteFinish(t,e,n,s){let a=this.options.awaitWriteFinish;if(typeof a!="object")return;let c=a.pollInterval,o,r=t;this.options.cwd&&!m.isAbsolute(t)&&(r=m.join(this.options.cwd,t));let d=new Date,f=this._pendingWrites;function h(l){ve(r,(p,u)=>{if(p||!f.has(t)){p&&p.code!=="ENOENT"&&s(p);return}let g=Number(new Date);l&&u.size!==l.size&&(f.get(t).lastChange=g);let P=f.get(t);g-P.lastChange>=e?(f.delete(t),s(void 0,u)):o=setTimeout(h,c,u)})}f.has(t)||(f.set(t,{lastChange:d,cancelWait:()=>(f.delete(t),clearTimeout(o),n)}),o=setTimeout(h,c))}_isIgnored(t,e){if(this.options.atomic&&Se.test(t))return!0;if(!this._userIgnored){let{cwd:n}=this.options,a=(this.options.ignored||[]).map(Mt(n)),o=[...[...this._ignoredPaths].map(Mt(n)),...a];this._userIgnored=Le(o,void 0)}return this._userIgnored(t,e)}_isntIgnored(t,e){return!this._isIgnored(t,e)}_getWatchHelpers(t){return new ut(t,this.options.followSymlinks,this)}_getWatchedDir(t){let e=m.resolve(t);return this._watched.has(e)||this._watched.set(e,new pt(e,this._boundRemove)),this._watched.get(e)}_hasReadPermissions(t){return this.options.ignorePermissionErrors?!0:!!(Number(t.mode)&256)}_remove(t,e,n){let s=m.join(t,e),a=m.resolve(s);if(n=n??(this._watched.has(s)||this._watched.has(a)),!this._throttle("remove",s,100))return;!n&&this._watched.size===1&&this.add(t,e,!0),this._getWatchedDir(s).getChildren().forEach(l=>this._remove(s,l));let r=this._getWatchedDir(t),d=r.has(e);r.remove(e),this._symlinkPaths.has(a)&&this._symlinkPaths.delete(a);let f=s;if(this.options.cwd&&(f=m.relative(this.options.cwd,s)),this.options.awaitWriteFinish&&this._pendingWrites.has(f)&&this._pendingWrites.get(f).cancelWait()===D.ADD)return;this._watched.delete(s),this._watched.delete(a);let h=n?D.UNLINK_DIR:D.UNLINK;d&&!this._isIgnored(s)&&this._emit(h,s),this._closePath(s)}_closePath(t){this._closeFile(t);let e=m.dirname(t);this._getWatchedDir(e).remove(m.basename(t))}_closeFile(t){let e=this._closers.get(t);e&&(e.forEach(n=>n()),this._closers.delete(t))}_addPathCloser(t,e){if(!e)return;let n=this._closers.get(t);n||(n=[],this._closers.set(t,n)),n.push(e)}_readdirp(t,e){if(this.closed)return;let n={type:D.ALL,alwaysStat:!0,lstat:!0,...e,depth:0},s=Rt(t,n);return this._streams.add(s),s.once($t,()=>{s=void 0}),s.once(lt,()=>{s&&(this._streams.delete(s),s=void 0)}),s}};function Ye(i,t={}){let e=new Q(t);return e.add(i),e}var jt={watch:Ye,FSWatcher:Q};import{pathToFileURL as ss,fileURLToPath as is}from"node:url";import{join as b,sep as wt,dirname as ns}from"node:path";import{copyFile as G,cp as rs,readFile as os,writeFile as Kt}from"node:fs/promises";import{access as Ue}from"node:fs/promises";import{constants as Ge}from"node:fs";async function S(i){try{return await Ue(i,Ge.F_OK),!0}catch{return!1}}import{access as Ve}from"node:fs/promises";import{constants as Be}from"node:fs";async function H(i){try{return await Ve(i,Be.F_OK),!0}catch{return!1}}import{join as M}from"node:path";import{readdir as Ke}from"node:fs/promises";async function L(i){let t=[];try{let e=await Ke(i,{withFileTypes:!0});for(let n of e)n.isDirectory()&&t.push(n.name)}catch(e){console.error("Error reading directory:",e)}return t}import{readFile as Ot}from"node:fs/promises";function tt(i){return i&&i.charAt(0).toUpperCase()+i.slice(1)}function et(i){return i.replace(/([a-zA-Z])(?=[A-Z])/g,"$1-").toLowerCase()}var mt=i=>`\x1B[31m${i}\x1B[0m`,Us=process.cwd();var j="src",W="components";function zt(i){return{name:"playground-plugin",setup(t){let e="playground-entry",n="playground-module";t.onResolve({filter:new RegExp(`^${e}$`)},s=>({path:e,namespace:n})),t.onLoad({filter:/.*/,namespace:n},async s=>{let a=[],c=await L(M(j,W));c.length===0&&(console.log(mt('Missing at least 1 namespace folder under "src/components/"')),process.exit());let o=[];for(let r of c){let d={namespace:r,components:[]};o.push(d);let f=M(j,W,r),h=await L(f);for(let l of h)if(await S(M(j,W,r,l,`${l}.ts`))){let p="";await S(M(j,W,r,l,"README.md"))&&(p=await Ot(M(j,W,r,l,"README.md"),"utf8"));let u={namespace:r,component:l,tag:`${r}-${et(l)}`,examples:[],className:"",classExtends:"",readme:p};if(a.push(`import '${W}/${r}/${l}/${l}';`),await H(M(f,l,"__examples__"))){let _=await L(M(f,l,"__examples__"));for(let w of _)await S(M(f,l,"__examples__",w,`${w}.ts`))?(a.push(`import '${W}/${r}/${l}/__examples__/${w}/${w}';`),u.examples.push({namespace:r,component:l,example:w,tag:`x-${r}-${et(l)}-${et(w)}`,className:`X${tt(r)}${tt(l)}${tt(w)}`})):console.log(mt(`Missing ${W}/${r}/${l}/__examples__/${w}/${w}.ts`))}let P=(await Ot(M(j,W,r,l,`${l}.ts`),"utf8")).match(/class (\w+) extends (\w+)/);P||(console.log(mt(`Component "${r}-${l}" must extend HtmlElement or base class`)),process.exit()),u.className=P[1],u.classExtends=P[2],d.components.push(u)}}return i.after(o),{contents:a.join(`
`),resolveDir:M(process.cwd(),j)}})}}}import{sep as Yt}from"node:path";import{readFile as Ze}from"node:fs/promises";function Ht(i){return i.replace(/-([a-z])/g,t=>t[1].toUpperCase())}var qe="node_modules",Je=process.cwd(),Xe=Je.split(Yt).length,Qe=i=>`\x1B[31m${i}\x1B[0m`;function Ut({localNamespaces:i,externalNamespaces:t}){return{name:"html-dependents-plugin",setup(e){e.onLoad({filter:/\.html$/},async n=>{let s=n.path.split(Yt).splice(Xe),[a,c,o,r,...d]=s,f=await Ze(n.path,"utf8"),h=f.matchAll(/<\/(?<namespace>\w+)-(?<value>[^>]+)/g),l=new Map;for(let u of h){let{namespace:g,value:P}=u.groups,_=Ht(P);l.set(`${g}-${_}`,[g,_])}let p=[];return l.forEach(([u,g])=>{let P=s.length-4,_=new Array(P).fill("..");if(u===o){if(g===r)return;p.push(`import './${_.join("/")}/${g}/${g}';`)}else if(i.includes(u))p.push(`import './${_.join("/")}/${u}/${g}/${g}';`);else if(t.has(u)){_.push(".."),_.push(".."),_.push("..");let w=t.get(u);p.push(`import './${_.join("/")}/${qe}/${w}/${u}/${g}/${g}';`)}else console.log(Qe(`Unable to find namespace folder "${u}". Possibly missing 'external' in element.config.ts`)),process.exit()}),p.push(`export default \`${f}\`;`),{contents:p.join(`
`),loader:"js"}})}}}var ts=i=>`\x1B[32m${i}\x1B[0m`,Gt={name:"rebuild-notify",setup(i){i.onEnd(t=>{t.errors.length>0?console.error(`Build ended with ${t.errors.length} errors`):console.log(ts("Build succeeded!"))})}};import{join as _t}from"node:path";import{readFile as Vt}from"node:fs/promises";async function Bt({mode:i,rootDir:t,srcDir:e,indexFile:n,defaultDir:s,playgroundFile:a,title:c,repo:o,repoComponent:r,navigation:d,namespaces:f}){let h="";await S(_t(t,e,n))?h=await Vt(_t(t,e,n),"utf8"):h=await Vt(_t(s,a),"utf8"),h=h.replace("<title>Default</title>",`<title>${c??"Default"}</title>`),h=h.replace("<h1>Default</h1>",`<h1>${c??"Default"}</h1>`);let l=structuredClone(d??[]);for(let P of l)P.items=[];let p;l.length===0?(p={label:"Components",items:[]},l.push(p)):(p=l.find(P=>!P.extends&&!P.components&&!P.namespaces),p||(p={label:"Other",items:[]},l.push(p)));let u=new Map;if(f.forEach(({components:P})=>{P.forEach(({component:_,namespace:w,tag:I,readme:v,examples:C,className:$,classExtends:O})=>{u.set($,{className:$,classExtends:O,component:_,namespace:w,tag:I,readme:v,examples:C.map(E=>E.className)}),C.forEach(E=>{u.set(E.className,{className:E.className,classExtends:E.classExtends,component:E.component,namespace:E.namespace,tag:E.tag,example:E.example})});for(let E of l)if(E.include&&E.include.includes($)){E.items.push({namespace:w,component:_,className:$,tag:I});return}for(let E of l)if(E!==p&&!(E.exclude&&E.exclude.includes($))&&!(E.namespaces&&!E.namespaces.includes(w))&&!(E.extends&&!E.extends.includes(O))){E.items.push({namespace:w,component:_,className:$,tag:I});return}p.items.push({namespace:w,component:_,examples:C,className:$,tag:I})})}),h=h.replace(/([ ]*)<!-- \[Navigation\] -->/,(P,_)=>l.map(({label:w,items:I})=>[_,`<div>${w}</div>`,"<ul>",I.map(({component:v,namespace:C,tag:$,className:O})=>[`<li data-tag="${$}" data-class-name="${O}" data-component="${v}"><a href="#${$}">${v}</a></li>`].join(`
${_}`)).join(`
${_}`),"</ul>"].join(`
${_}`)).join(`
${_}`)),o){let w=o.includes("github.com")?"M12,2A10,10 0 0,0 2,12C2,16.42 4.87,20.17 8.84,21.5C9.34,21.58 9.5,21.27 9.5,21C9.5,20.77 9.5,20.14 9.5,19.31C6.73,19.91 6.14,17.97 6.14,17.97C5.68,16.81 5.03,16.5 5.03,16.5C4.12,15.88 5.1,15.9 5.1,15.9C6.1,15.97 6.63,16.93 6.63,16.93C7.5,18.45 8.97,18 9.54,17.76C9.63,17.11 9.89,16.67 10.17,16.42C7.95,16.17 5.62,15.31 5.62,11.5C5.62,10.39 6,9.5 6.65,8.79C6.55,8.54 6.2,7.5 6.75,6.15C6.75,6.15 7.59,5.88 9.5,7.17C10.29,6.95 11.15,6.84 12,6.84C12.85,6.84 13.71,6.95 14.5,7.17C16.41,5.88 17.25,6.15 17.25,6.15C17.8,7.5 17.45,8.54 17.35,8.79C18,9.5 18.38,10.39 18.38,11.5C18.38,15.32 16.04,16.16 13.81,16.41C14.17,16.72 14.5,17.33 14.5,18.26C14.5,19.6 14.5,20.68 14.5,21C14.5,21.27 14.66,21.59 15.17,21.5C19.14,20.16 22,16.42 22,12A10,10 0 0,0 12,2Z":"M6,2H18A2,2 0 0,1 20,4V20A2,2 0 0,1 18,22H6A2,2 0 0,1 4,20V4A2,2 0 0,1 6,2M12.75,13.5C15.5,13.5 16.24,11.47 16.43,10.4C17.34,10.11 18,9.26 18,8.25C18,7 17,6 15.75,6C14.5,6 13.5,7 13.5,8.25C13.5,9.19 14.07,10 14.89,10.33C14.67,11 14,12 12,12C10.62,12 9.66,12.35 9,12.84V8.87C9.87,8.56 10.5,7.73 10.5,6.75C10.5,5.5 9.5,4.5 8.25,4.5C7,4.5 6,5.5 6,6.75C6,7.73 6.63,8.56 7.5,8.87V15.13C6.63,15.44 6,16.27 6,17.25C6,18.5 7,19.5 8.25,19.5C9.5,19.5 10.5,18.5 10.5,17.25C10.5,16.32 9.94,15.5 9.13,15.18C9.41,14.5 10.23,13.5 12.75,13.5M8.25,16.5A0.75,0.75 0 0,1 9,17.25A0.75,0.75 0 0,1 8.25,18A0.75,0.75 0 0,1 7.5,17.25A0.75,0.75 0 0,1 8.25,16.5M8.25,6A0.75,0.75 0 0,1 9,6.75A0.75,0.75 0 0,1 8.25,7.5A0.75,0.75 0 0,1 7.5,6.75A0.75,0.75 0 0,1 8.25,6M15.75,7.5A0.75,0.75 0 0,1 16.5,8.25A0.75,0.75 0 0,1 15.75,9A0.75,0.75 0 0,1 15,8.25A0.75,0.75 0 0,1 15.75,7.5Z";h=h.replace(/([ ]*)<!-- \[Repo\] -->/,(I,v)=>[v,`<a href="${o}">`,'  <svg viewBox="0 0 24 24">',`    <path fill="currentColor" d="${w}" />`,"  </svg>","  <span>View Repo</span>","</a>"].join(`
${v}`)),h=h.replace(/const repo = '';/,I=>`const repo = '${o}';`),h=h.replace(/const repoComponent = '';/,I=>`const repoComponent = '${r.replace(/\$repo/g,o)}';`),h=h.replace(/const repoIcon = '';/,I=>`const repoIcon = '${w}';`)}i==="dev"&&(h=h.replace(/([ ]*)<!-- \[info\] -->/,(P,_)=>[_,"<p>This page is generated from <code>npm start</code>. To render only specific components use <code>npm start c-button</code>.</p>"].join(`
${_}`)));let g=[...u.keys()];return h=h.replace(/([ ]*)const componentMap = new Map\(\);/,(P,_)=>[`${_}const componentMap = new Map();`,...g.map(w=>{let I=u.get(w);return`componentMap.set('${w}', ${JSON.stringify(I)});`})].join(`${_}
`)),h=h.replace(/([ ]*)const navigation = \[\];/,(P,_)=>`${_}const navigation = ${JSON.stringify(l,null,"  ")};`),h}(async()=>{let i=[Gt],t=R=>`\x1B[1m${R}\x1B[0m`,e=R=>`\x1B[32m${R}\x1B[0m`,n=R=>`\x1B[31m${R}\x1B[0m`,s=is(import.meta.url),a=ns(s),c=b(a,"..","default"),o="element.config.ts",r=process.cwd(),d="publish",f=ss(o);await S(o)||(console.log(n("Missing element.config.ts in root."),"Add with content:"),console.log("export default {"),console.log("  namespace: 'hello',"),console.log("}"),process.exit());let h=await import(f.href),{namespace:l,external:p,title:u,navigation:g,repo:P,repoComponent:_,copy:w}=h.default,I="node_modules",v="dist",C="src",$="components",O=await L(b(r,C,$)),E=new Map;for(let R of p??[])(await L(b(r,I,...R.split("/")))).forEach(y=>{y!==I&&E.set(y,R)});i.push(Ut({localNamespaces:O,externalNamespaces:E}));let st=[];if(l){console.log(e("Building app...")),st.push(`./${C}/${$}/${l}/app/app.ts`);let R="index.html";if(await S(b(r,C,R)))await G(b(r,C,R),b(r,v,R));else{let y=await os(b(c,R),"utf8");y=y.replace("<title>Default</title>",`<title>${u??"Default"}</title>`),y=y.replace("<namespace-app></namespace-app>",`<${l}-app></${l}-app>`),await Kt(b(r,v,R),y)}let T="favicon.svg";await S(b(r,C,T))?await G(b(r,C,T),b(r,v,T)):await G(b(c,T),b(r,v,T))}else{console.log(e("Building components...")),await H(b(C,$))||(console.log(n('Missing required "src/components" directory.')),process.exit());let R="playground.html",T="index.html";st.push("playground-entry"),i.push(zt({after:async y=>{let F=await Bt({mode:"dev",rootDir:r,srcDir:C,indexFile:T,defaultDir:c,playgroundFile:R,title:u,repo:P,repoComponent:_,navigation:g,namespaces:y});await Kt(b(r,v,T),F)}}))}let it=await es({entryPoints:st,outfile:`./${v}/main.js`,bundle:!0,format:"esm",target:"es2024",sourcemap:!0,minify:!1,loader:{".css":"text"},plugins:i});await it.rebuild(),(w??[]).forEach(async({from:R,to:T})=>{let y=T.split(wt),F=R.split(wt);F[F.length-1]===""&&(console.log(n('element.config.ts "copy" "from" should not end with a "/". Ex: "assets" not "assets/".')),process.exit()),y[y.length-1]===""&&(console.log(n('element.config.ts "copy" "to" should not end with a "/". Ex: "assets" not "assets/".')),process.exit()),await H(b(r,C,...F))?await rs(b(r,C,...F),b(r,v,...y),{recursive:!0}):await S(b(r,C,...F))&&await G(b(r,C,...F),b(r,v,...y))}),jt.watch("src",{ignoreInitial:!0}).on("all",async(R,T)=>{if(!l){let y=T.split(wt);y.length>4&&y[0]===C&&y[1]===$&&(console.log(`Copy "${y.slice(2).join("/")}" to publish/*`),await G(b(r,...y),b(r,d,...y.slice(2)))),(R==="change"||R==="add")&&((w??[]).array.forEach(async({from:F,to:qt})=>{let gt=y.slice(1).join("/");gt.startsWith(F)&&console.log("copy after",gt,F,qt)}),await H(b(r,...y)))}try{await it.rebuild()}catch(y){console.error("Rebuild failed:",y)}});let{port:Zt}=await it.serve({servedir:v});console.log(e("Dev server started at"),`localhost:${Zt}`)})();
/*! Bundled license information:

chokidar/index.js:
  (*! chokidar - MIT License (c) 2012 Paul Miller (paulmillr.com) *)
*/

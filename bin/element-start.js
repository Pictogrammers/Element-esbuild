#!/usr/bin/env node
import { createRequire } from 'node:module'; const require = createRequire(import.meta.url);
import{context as Ve}from"esbuild";import{EventEmitter as ye}from"node:events";import{stat as Ee}from"node:fs";import{readdir as Pe,stat as xe}from"node:fs/promises";import*as u from"node:path";import{lstat as pt,readdir as Ut,realpath as Gt,stat as Vt}from"node:fs/promises";import{join as Bt,relative as Kt,resolve as mt,sep as Zt}from"node:path";import{Readable as qt}from"node:stream";var C={FILE_TYPE:"files",DIR_TYPE:"directories",FILE_DIR_TYPE:"files_directories",EVERYTHING_TYPE:"all"},tt={root:".",fileFilter:i=>!0,directoryFilter:i=>!0,type:C.FILE_TYPE,lstat:!1,depth:2147483648,alwaysStat:!1,highWaterMark:4096};Object.freeze(tt);var gt="READDIRP_RECURSIVE_ERROR",Jt=new Set(["ENOENT","EPERM","EACCES","ELOOP",gt]),ut=[C.DIR_TYPE,C.EVERYTHING_TYPE,C.FILE_DIR_TYPE,C.FILE_TYPE],Xt=new Set([C.DIR_TYPE,C.EVERYTHING_TYPE,C.FILE_DIR_TYPE]),Qt=new Set([C.EVERYTHING_TYPE,C.FILE_DIR_TYPE,C.FILE_TYPE]),te=i=>Jt.has(i.code),ee=process.platform==="win32",_t=i=>!0,wt=i=>{if(i===void 0)return _t;if(typeof i=="function")return i;if(typeof i=="string"){let t=i.trim();return e=>e.basename===t}if(Array.isArray(i)){let t=i.map(e=>e.trim());return e=>t.some(n=>e.basename===n)}return _t},et=class extends qt{parents;reading;parent;_stat;_maxDepth;_wantsDir;_wantsFile;_wantsEverything;_root;_isDirent;_statsProp;_rdOptions;_fileFilter;_directoryFilter;constructor(t={}){super({objectMode:!0,autoDestroy:!0,highWaterMark:t.highWaterMark});let e={...tt,...t},{root:n,type:s}=e;this._fileFilter=wt(e.fileFilter),this._directoryFilter=wt(e.directoryFilter);let o=e.lstat?pt:Vt;ee?this._stat=c=>o(c,{bigint:!0}):this._stat=o,this._maxDepth=e.depth!=null&&Number.isSafeInteger(e.depth)?e.depth:tt.depth,this._wantsDir=s?Xt.has(s):!1,this._wantsFile=s?Qt.has(s):!1,this._wantsEverything=s===C.EVERYTHING_TYPE,this._root=mt(n),this._isDirent=!e.alwaysStat,this._statsProp=this._isDirent?"dirent":"stats",this._rdOptions={encoding:"utf8",withFileTypes:this._isDirent},this.parents=[this._exploreDir(n,1)],this.reading=!1,this.parent=void 0}async _read(t){if(!this.reading){this.reading=!0;try{for(;!this.destroyed&&t>0;){let e=this.parent,n=e&&e.files;if(n&&n.length>0){let{path:s,depth:o}=e,c=n.splice(0,t).map(r=>this._formatEntry(r,s)),a=await Promise.all(c);for(let r of a){if(!r)continue;if(this.destroyed)return;let d=await this._getEntryType(r);d==="directory"&&this._directoryFilter(r)?(o<=this._maxDepth&&this.parents.push(this._exploreDir(r.fullPath,o+1)),this._wantsDir&&(this.push(r),t--)):(d==="file"||this._includeAsFile(r))&&this._fileFilter(r)&&this._wantsFile&&(this.push(r),t--)}}else{let s=this.parents.pop();if(!s){this.push(null);break}if(this.parent=await s,this.destroyed)return}}}catch(e){this.destroy(e)}finally{this.reading=!1}}}async _exploreDir(t,e){let n;try{n=await Ut(t,this._rdOptions)}catch(s){this._onError(s)}return{files:n,depth:e,path:t}}async _formatEntry(t,e){let n,s=this._isDirent?t.name:t;try{let o=mt(Bt(e,s));n={path:Kt(this._root,o),fullPath:o,basename:s},n[this._statsProp]=this._isDirent?t:await this._stat(o)}catch(o){this._onError(o);return}return n}_onError(t){te(t)&&!this.destroyed?this.emit("warn",t):this.destroy(t)}async _getEntryType(t){if(!t&&this._statsProp in t)return"";let e=t[this._statsProp];if(e.isFile())return"file";if(e.isDirectory())return"directory";if(e&&e.isSymbolicLink()){let n=t.fullPath;try{let s=await Gt(n),o=await pt(s);if(o.isFile())return"file";if(o.isDirectory()){let c=s.length;if(n.startsWith(s)&&n.substr(c,1)===Zt){let a=new Error(`Circular symlink detected: "${n}" points to "${s}"`);return a.code=gt,this._onError(a)}return"directory"}}catch(s){return this._onError(s),""}}}_includeAsFile(t){let e=t&&t[this._statsProp];return e&&this._wantsEverything&&!e.isDirectory()}};function yt(i,t={}){let e=t.entryType||t.type;if(e==="both"&&(e=C.FILE_DIR_TYPE),e&&(t.type=e),i){if(typeof i!="string")throw new TypeError("readdirp: root argument must be a string. Usage: readdirp(root, options)");if(e&&!ut.includes(e))throw new Error(`readdirp: Invalid type passed. Use one of ${ut.join(", ")}`)}else throw new Error("readdirp: root argument is required. Usage: readdirp(root, options)");return t.root=i,new et(t)}import{watch as se,unwatchFile as Et,watchFile as ie}from"node:fs";import{realpath as st,lstat as ne,open as re,stat as xt}from"node:fs/promises";import{type as oe}from"node:os";import*as y from"node:path";var ae="data",rt="end",bt="close",G=()=>{};var V=process.platform,ot=V==="win32",ce=V==="darwin",le=V==="linux",he=V==="freebsd",Dt=oe()==="OS400",E={ALL:"all",READY:"ready",ADD:"add",CHANGE:"change",ADD_DIR:"addDir",UNLINK:"unlink",UNLINK_DIR:"unlinkDir",RAW:"raw",ERROR:"error"},T=E,fe="watch",de={lstat:ne,stat:xt},W="listeners",z="errHandlers",k="rawEmitters",pe=[W,z,k],me=new Set(["3dm","3ds","3g2","3gp","7z","a","aac","adp","afdesign","afphoto","afpub","ai","aif","aiff","alz","ape","apk","appimage","ar","arj","asf","au","avi","bak","baml","bh","bin","bk","bmp","btif","bz2","bzip2","cab","caf","cgm","class","cmx","cpio","cr2","cur","dat","dcm","deb","dex","djvu","dll","dmg","dng","doc","docm","docx","dot","dotm","dra","DS_Store","dsk","dts","dtshd","dvb","dwg","dxf","ecelp4800","ecelp7470","ecelp9600","egg","eol","eot","epub","exe","f4v","fbs","fh","fla","flac","flatpak","fli","flv","fpx","fst","fvt","g3","gh","gif","graffle","gz","gzip","h261","h263","h264","icns","ico","ief","img","ipa","iso","jar","jpeg","jpg","jpgv","jpm","jxr","key","ktx","lha","lib","lvp","lz","lzh","lzma","lzo","m3u","m4a","m4v","mar","mdi","mht","mid","midi","mj2","mka","mkv","mmr","mng","mobi","mov","movie","mp3","mp4","mp4a","mpeg","mpg","mpga","mxu","nef","npx","numbers","nupkg","o","odp","ods","odt","oga","ogg","ogv","otf","ott","pages","pbm","pcx","pdb","pdf","pea","pgm","pic","png","pnm","pot","potm","potx","ppa","ppam","ppm","pps","ppsm","ppsx","ppt","pptm","pptx","psd","pya","pyc","pyo","pyv","qt","rar","ras","raw","resources","rgb","rip","rlc","rmf","rmvb","rpm","rtf","rz","s3m","s7z","scpt","sgi","shar","snap","sil","sketch","slk","smv","snk","so","stl","suo","sub","swf","tar","tbz","tbz2","tga","tgz","thmx","tif","tiff","tlz","ttc","ttf","txz","udf","uvh","uvi","uvm","uvp","uvs","uvu","viv","vob","war","wav","wax","wbmp","wdp","weba","webm","webp","whl","wim","wm","wma","wmv","wmx","woff","woff2","wrm","wvx","xbm","xif","xla","xlam","xls","xlsb","xlsm","xlsx","xlt","xltm","xltx","xm","xmind","xpi","xpm","xwd","xz","z","zip","zipx"]),ue=i=>me.has(y.extname(i).slice(1).toLowerCase()),nt=(i,t)=>{i instanceof Set?i.forEach(t):t(i)},j=(i,t,e)=>{let n=i[t];n instanceof Set||(i[t]=n=new Set([n])),n.add(e)},_e=i=>t=>{let e=i[t];e instanceof Set?e.clear():delete i[t]},O=(i,t,e)=>{let n=i[t];n instanceof Set?n.delete(e):n===e&&delete i[t]},Rt=i=>i instanceof Set?i.size===0:!i,H=new Map;function Pt(i,t,e,n,s){let o=(c,a)=>{e(i),s(c,a,{watchedPath:i}),a&&i!==a&&Y(y.resolve(i,a),W,y.join(i,a))};try{return se(i,{persistent:t.persistent},o)}catch(c){n(c);return}}var Y=(i,t,e,n,s)=>{let o=H.get(i);o&&nt(o[t],c=>{c(e,n,s)})},we=(i,t,e,n)=>{let{listener:s,errHandler:o,rawEmitter:c}=n,a=H.get(t),r;if(!e.persistent)return r=Pt(i,e,s,o,c),r?r.close.bind(r):void 0;if(a)j(a,W,s),j(a,z,o),j(a,k,c);else{if(r=Pt(i,e,Y.bind(null,t,W),o,Y.bind(null,t,k)),!r)return;r.on(T.ERROR,async d=>{let f=Y.bind(null,t,z);if(a&&(a.watcherUnusable=!0),ot&&d.code==="EPERM")try{await(await re(i,"r")).close(),f(d)}catch{}else f(d)}),a={listeners:s,errHandlers:o,rawEmitters:c,watcher:r},H.set(t,a)}return()=>{O(a,W,s),O(a,z,o),O(a,k,c),Rt(a.listeners)&&(a.watcher.close(),H.delete(t),pe.forEach(_e(a)),a.watcher=void 0,Object.freeze(a))}},it=new Map,ge=(i,t,e,n)=>{let{listener:s,rawEmitter:o}=n,c=it.get(t),a=c&&c.options;return a&&(a.persistent<e.persistent||a.interval>e.interval)&&(Et(t),c=void 0),c?(j(c,W,s),j(c,k,o)):(c={listeners:s,rawEmitters:o,options:e,watcher:ie(t,e,(r,d)=>{nt(c.rawEmitters,h=>{h(T.CHANGE,t,{curr:r,prev:d})});let f=r.mtimeMs;(r.size!==d.size||f>d.mtimeMs||f===0)&&nt(c.listeners,h=>h(i,r))})},it.set(t,c)),()=>{O(c,W,s),O(c,k,o),Rt(c.listeners)&&(it.delete(t),Et(t),c.options=c.watcher=void 0,Object.freeze(c))}},U=class{fsw;_boundHandleError;constructor(t){this.fsw=t,this._boundHandleError=e=>t._handleError(e)}_watchWithNodeFs(t,e){let n=this.fsw.options,s=y.dirname(t),o=y.basename(t);this.fsw._getWatchedDir(s).add(o);let a=y.resolve(t),r={persistent:n.persistent};e||(e=G);let d;if(n.usePolling){let f=n.interval!==n.binaryInterval;r.interval=f&&ue(o)?n.binaryInterval:n.interval,d=ge(t,a,r,{listener:e,rawEmitter:this.fsw._emitRaw})}else d=we(t,a,r,{listener:e,errHandler:this._boundHandleError,rawEmitter:this.fsw._emitRaw});return d}_handleFile(t,e,n){if(this.fsw.closed)return;let s=y.dirname(t),o=y.basename(t),c=this.fsw._getWatchedDir(s),a=e;if(c.has(o))return;let r=async(f,h)=>{if(this.fsw._throttle(fe,t,5)){if(!h||h.mtimeMs===0)try{let l=await xt(t);if(this.fsw.closed)return;let p=l.atimeMs,_=l.mtimeMs;if((!p||p<=_||_!==a.mtimeMs)&&this.fsw._emit(T.CHANGE,t,l),(ce||le||he)&&a.ino!==l.ino){this.fsw._closeFile(f),a=l;let P=this._watchWithNodeFs(t,r);P&&this.fsw._addPathCloser(f,P)}else a=l}catch{this.fsw._remove(s,o)}else if(c.has(o)){let l=h.atimeMs,p=h.mtimeMs;(!l||l<=p||p!==a.mtimeMs)&&this.fsw._emit(T.CHANGE,t,h),a=h}}},d=this._watchWithNodeFs(t,r);if(!(n&&this.fsw.options.ignoreInitial)&&this.fsw._isntIgnored(t)){if(!this.fsw._throttle(T.ADD,t,0))return;this.fsw._emit(T.ADD,t,e)}return d}async _handleSymlink(t,e,n,s){if(this.fsw.closed)return;let o=t.fullPath,c=this.fsw._getWatchedDir(e);if(!this.fsw.options.followSymlinks){this.fsw._incrReadyCount();let a;try{a=await st(n)}catch{return this.fsw._emitReady(),!0}return this.fsw.closed?void 0:(c.has(s)?this.fsw._symlinkPaths.get(o)!==a&&(this.fsw._symlinkPaths.set(o,a),this.fsw._emit(T.CHANGE,n,t.stats)):(c.add(s),this.fsw._symlinkPaths.set(o,a),this.fsw._emit(T.ADD,n,t.stats)),this.fsw._emitReady(),!0)}if(this.fsw._symlinkPaths.has(o))return!0;this.fsw._symlinkPaths.set(o,!0)}_handleRead(t,e,n,s,o,c,a){t=y.join(t,"");let r=s?`${t}:${s}`:t;if(a=this.fsw._throttle("readdir",r,1e3),!a)return;let d=this.fsw._getWatchedDir(n.path),f=new Set,h=this.fsw._readdirp(t,{fileFilter:l=>n.filterPath(l),directoryFilter:l=>n.filterDir(l)});if(h)return h.on(ae,async l=>{if(this.fsw.closed){h=void 0;return}let p=l.path,_=y.join(t,p);if(f.add(p),!(l.stats.isSymbolicLink()&&await this._handleSymlink(l,t,_,p))){if(this.fsw.closed){h=void 0;return}(p===s||!s&&!d.has(p))&&(this.fsw._incrReadyCount(),_=y.join(o,y.relative(o,_)),this._addToNodeFs(_,e,n,c+1))}}).on(T.ERROR,this._boundHandleError),new Promise((l,p)=>{if(!h)return p();h.once(rt,()=>{if(this.fsw.closed){h=void 0;return}let _=a?a.clear():!1;l(void 0),d.getChildren().filter(P=>P!==t&&!f.has(P)).forEach(P=>{this.fsw._remove(t,P)}),h=void 0,_&&this._handleRead(t,!1,n,s,o,c,a)})})}async _handleDir(t,e,n,s,o,c,a){let r=this.fsw._getWatchedDir(y.dirname(t)),d=r.has(y.basename(t));!(n&&this.fsw.options.ignoreInitial)&&!o&&!d&&this.fsw._emit(T.ADD_DIR,t,e),r.add(y.basename(t)),this.fsw._getWatchedDir(t);let f,h,l=this.fsw.options.depth;if((l==null||s<=l)&&!this.fsw._symlinkPaths.has(a)){if(!o&&(await this._handleRead(t,n,c,o,t,s,f),this.fsw.closed))return;h=this._watchWithNodeFs(t,(p,_)=>{_&&_.mtimeMs===0||this._handleRead(p,!1,c,o,t,s,f)})}return h}async _addToNodeFs(t,e,n,s,o){let c=this.fsw._emitReady;if(this.fsw._isIgnored(t)||this.fsw.closed)return c(),!1;let a=this.fsw._getWatchHelpers(t);n&&(a.filterPath=r=>n.filterPath(r),a.filterDir=r=>n.filterDir(r));try{let r=await de[a.statMethod](a.watchPath);if(this.fsw.closed)return;if(this.fsw._isIgnored(a.watchPath,r))return c(),!1;let d=this.fsw.options.followSymlinks,f;if(r.isDirectory()){let h=y.resolve(t),l=d?await st(t):t;if(this.fsw.closed||(f=await this._handleDir(a.watchPath,r,e,s,o,a,l),this.fsw.closed))return;h!==l&&l!==void 0&&this.fsw._symlinkPaths.set(h,l)}else if(r.isSymbolicLink()){let h=d?await st(t):t;if(this.fsw.closed)return;let l=y.dirname(a.watchPath);if(this.fsw._getWatchedDir(l).add(a.watchPath),this.fsw._emit(T.ADD,a.watchPath,r),f=await this._handleDir(l,r,e,s,t,a,h),this.fsw.closed)return;h!==void 0&&this.fsw._symlinkPaths.set(y.resolve(t),h)}else f=this._handleFile(a.watchPath,r,e);return c(),f&&this.fsw._addPathCloser(t,f),!1}catch(r){if(this.fsw._handleError(r))return c(),t}}};var at="/",be="//",At=".",De="..",Re="string",Ce=/\\/g,Ft=/\/\//g,ve=/\..*\.(sw[px])$|~$|\.subl.*\.tmp/,Ie=/^\.[/\\]/;function B(i){return Array.isArray(i)?i:[i]}var ct=i=>typeof i=="object"&&i!==null&&!(i instanceof RegExp);function Te(i){return typeof i=="function"?i:typeof i=="string"?t=>i===t:i instanceof RegExp?t=>i.test(t):typeof i=="object"&&i!==null?t=>{if(i.path===t)return!0;if(i.recursive){let e=u.relative(i.path,t);return e?!e.startsWith("..")&&!u.isAbsolute(e):!1}return!1}:()=>!1}function Ae(i){if(typeof i!="string")throw new Error("string expected");i=u.normalize(i),i=i.replace(/\\/g,"/");let t=!1;return i.startsWith("//")&&(t=!0),i=i.replace(Ft,"/"),t&&(i="/"+i),i}function Ct(i,t,e){let n=Ae(t);for(let s=0;s<i.length;s++){let o=i[s];if(o(n,e))return!0}return!1}function Fe(i,t){if(i==null)throw new TypeError("anymatch: specify first argument");let n=B(i).map(s=>Te(s));return t==null?(s,o)=>Ct(n,s,o):Ct(n,t)}var vt=i=>{let t=B(i).flat();if(!t.every(e=>typeof e===Re))throw new TypeError(`Non-string provided as watch path: ${t}`);return t.map($t)},It=i=>{let t=i.replace(Ce,at),e=!1;return t.startsWith(be)&&(e=!0),t=t.replace(Ft,at),e&&(t=at+t),t},$t=i=>It(u.normalize(It(i))),Tt=(i="")=>t=>typeof t=="string"?$t(u.isAbsolute(t)?t:u.join(i,t)):t,$e=(i,t)=>u.isAbsolute(i)?i:u.join(t,i),Se=Object.freeze(new Set),lt=class{path;_removeWatcher;items;constructor(t,e){this.path=t,this._removeWatcher=e,this.items=new Set}add(t){let{items:e}=this;e&&t!==At&&t!==De&&e.add(t)}async remove(t){let{items:e}=this;if(!e||(e.delete(t),e.size>0))return;let n=this.path;try{await Pe(n)}catch{this._removeWatcher&&this._removeWatcher(u.dirname(n),u.basename(n))}}has(t){let{items:e}=this;if(e)return e.has(t)}getChildren(){let{items:t}=this;return t?[...t.values()]:[]}dispose(){this.items.clear(),this.path="",this._removeWatcher=G,this.items=Se,Object.freeze(this)}},Ne="stat",We="lstat",ht=class{fsw;path;watchPath;fullWatchPath;dirParts;followSymlinks;statMethod;constructor(t,e,n){this.fsw=n;let s=t;this.path=t=t.replace(Ie,""),this.watchPath=s,this.fullWatchPath=u.resolve(s),this.dirParts=[],this.dirParts.forEach(o=>{o.length>1&&o.pop()}),this.followSymlinks=e,this.statMethod=e?Ne:We}entryPath(t){return u.join(this.watchPath,u.relative(this.watchPath,t.fullPath))}filterPath(t){let{stats:e}=t;if(e&&e.isSymbolicLink())return this.filterDir(t);let n=this.entryPath(t);return this.fsw._isntIgnored(n,e)&&this.fsw._hasReadPermissions(e)}filterDir(t){return this.fsw._isntIgnored(this.entryPath(t),t.stats)}},K=class extends ye{closed;options;_closers;_ignoredPaths;_throttled;_streams;_symlinkPaths;_watched;_pendingWrites;_pendingUnlinks;_readyCount;_emitReady;_closePromise;_userIgnored;_readyEmitted;_emitRaw;_boundRemove;_nodeFsHandler;constructor(t={}){super(),this.closed=!1,this._closers=new Map,this._ignoredPaths=new Set,this._throttled=new Map,this._streams=new Set,this._symlinkPaths=new Map,this._watched=new Map,this._pendingWrites=new Map,this._pendingUnlinks=new Map,this._readyCount=0,this._readyEmitted=!1;let e=t.awaitWriteFinish,n={stabilityThreshold:2e3,pollInterval:100},s={persistent:!0,ignoreInitial:!1,ignorePermissionErrors:!1,interval:100,binaryInterval:300,followSymlinks:!0,usePolling:!1,atomic:!0,...t,ignored:t.ignored?B(t.ignored):B([]),awaitWriteFinish:e===!0?n:typeof e=="object"?{...n,...e}:!1};Dt&&(s.usePolling=!0),s.atomic===void 0&&(s.atomic=!s.usePolling);let o=process.env.CHOKIDAR_USEPOLLING;if(o!==void 0){let r=o.toLowerCase();r==="false"||r==="0"?s.usePolling=!1:r==="true"||r==="1"?s.usePolling=!0:s.usePolling=!!r}let c=process.env.CHOKIDAR_INTERVAL;c&&(s.interval=Number.parseInt(c,10));let a=0;this._emitReady=()=>{a++,a>=this._readyCount&&(this._emitReady=G,this._readyEmitted=!0,process.nextTick(()=>this.emit(E.READY)))},this._emitRaw=(...r)=>this.emit(E.RAW,...r),this._boundRemove=this._remove.bind(this),this.options=s,this._nodeFsHandler=new U(this),Object.freeze(s)}_addIgnoredPath(t){if(ct(t)){for(let e of this._ignoredPaths)if(ct(e)&&e.path===t.path&&e.recursive===t.recursive)return}this._ignoredPaths.add(t)}_removeIgnoredPath(t){if(this._ignoredPaths.delete(t),typeof t=="string")for(let e of this._ignoredPaths)ct(e)&&e.path===t&&this._ignoredPaths.delete(e)}add(t,e,n){let{cwd:s}=this.options;this.closed=!1,this._closePromise=void 0;let o=vt(t);return s&&(o=o.map(c=>$e(c,s))),o.forEach(c=>{this._removeIgnoredPath(c)}),this._userIgnored=void 0,this._readyCount||(this._readyCount=0),this._readyCount+=o.length,Promise.all(o.map(async c=>{let a=await this._nodeFsHandler._addToNodeFs(c,!n,void 0,0,e);return a&&this._emitReady(),a})).then(c=>{this.closed||c.forEach(a=>{a&&this.add(u.dirname(a),u.basename(e||a))})}),this}unwatch(t){if(this.closed)return this;let e=vt(t),{cwd:n}=this.options;return e.forEach(s=>{!u.isAbsolute(s)&&!this._closers.has(s)&&(n&&(s=u.join(n,s)),s=u.resolve(s)),this._closePath(s),this._addIgnoredPath(s),this._watched.has(s)&&this._addIgnoredPath({path:s,recursive:!0}),this._userIgnored=void 0}),this}close(){if(this._closePromise)return this._closePromise;this.closed=!0,this.removeAllListeners();let t=[];return this._closers.forEach(e=>e.forEach(n=>{let s=n();s instanceof Promise&&t.push(s)})),this._streams.forEach(e=>e.destroy()),this._userIgnored=void 0,this._readyCount=0,this._readyEmitted=!1,this._watched.forEach(e=>e.dispose()),this._closers.clear(),this._watched.clear(),this._streams.clear(),this._symlinkPaths.clear(),this._throttled.clear(),this._closePromise=t.length?Promise.all(t).then(()=>{}):Promise.resolve(),this._closePromise}getWatched(){let t={};return this._watched.forEach((e,n)=>{let o=(this.options.cwd?u.relative(this.options.cwd,n):n)||At;t[o]=e.getChildren().sort()}),t}emitWithAll(t,e){this.emit(t,...e),t!==E.ERROR&&this.emit(E.ALL,t,...e)}async _emit(t,e,n){if(this.closed)return;let s=this.options;ot&&(e=u.normalize(e)),s.cwd&&(e=u.relative(s.cwd,e));let o=[e];n!=null&&o.push(n);let c=s.awaitWriteFinish,a;if(c&&(a=this._pendingWrites.get(e)))return a.lastChange=new Date,this;if(s.atomic){if(t===E.UNLINK)return this._pendingUnlinks.set(e,[t,...o]),setTimeout(()=>{this._pendingUnlinks.forEach((r,d)=>{this.emit(...r),this.emit(E.ALL,...r),this._pendingUnlinks.delete(d)})},typeof s.atomic=="number"?s.atomic:100),this;t===E.ADD&&this._pendingUnlinks.has(e)&&(t=E.CHANGE,this._pendingUnlinks.delete(e))}if(c&&(t===E.ADD||t===E.CHANGE)&&this._readyEmitted){let r=(d,f)=>{d?(t=E.ERROR,o[0]=d,this.emitWithAll(t,o)):f&&(o.length>1?o[1]=f:o.push(f),this.emitWithAll(t,o))};return this._awaitWriteFinish(e,c.stabilityThreshold,t,r),this}if(t===E.CHANGE&&!this._throttle(E.CHANGE,e,50))return this;if(s.alwaysStat&&n===void 0&&(t===E.ADD||t===E.ADD_DIR||t===E.CHANGE)){let r=s.cwd?u.join(s.cwd,e):e,d;try{d=await xe(r)}catch{}if(!d||this.closed)return;o.push(d)}return this.emitWithAll(t,o),this}_handleError(t){let e=t&&t.code;return t&&e!=="ENOENT"&&e!=="ENOTDIR"&&(!this.options.ignorePermissionErrors||e!=="EPERM"&&e!=="EACCES")&&this.emit(E.ERROR,t),t||this.closed}_throttle(t,e,n){this._throttled.has(t)||this._throttled.set(t,new Map);let s=this._throttled.get(t);if(!s)throw new Error("invalid throttle");let o=s.get(e);if(o)return o.count++,!1;let c,a=()=>{let d=s.get(e),f=d?d.count:0;return s.delete(e),clearTimeout(c),d&&clearTimeout(d.timeoutObject),f};c=setTimeout(a,n);let r={timeoutObject:c,clear:a,count:0};return s.set(e,r),r}_incrReadyCount(){return this._readyCount++}_awaitWriteFinish(t,e,n,s){let o=this.options.awaitWriteFinish;if(typeof o!="object")return;let c=o.pollInterval,a,r=t;this.options.cwd&&!u.isAbsolute(t)&&(r=u.join(this.options.cwd,t));let d=new Date,f=this._pendingWrites;function h(l){Ee(r,(p,_)=>{if(p||!f.has(t)){p&&p.code!=="ENOENT"&&s(p);return}let P=Number(new Date);l&&_.size!==l.size&&(f.get(t).lastChange=P);let x=f.get(t);P-x.lastChange>=e?(f.delete(t),s(void 0,_)):a=setTimeout(h,c,_)})}f.has(t)||(f.set(t,{lastChange:d,cancelWait:()=>(f.delete(t),clearTimeout(a),n)}),a=setTimeout(h,c))}_isIgnored(t,e){if(this.options.atomic&&ve.test(t))return!0;if(!this._userIgnored){let{cwd:n}=this.options,o=(this.options.ignored||[]).map(Tt(n)),a=[...[...this._ignoredPaths].map(Tt(n)),...o];this._userIgnored=Fe(a,void 0)}return this._userIgnored(t,e)}_isntIgnored(t,e){return!this._isIgnored(t,e)}_getWatchHelpers(t){return new ht(t,this.options.followSymlinks,this)}_getWatchedDir(t){let e=u.resolve(t);return this._watched.has(e)||this._watched.set(e,new lt(e,this._boundRemove)),this._watched.get(e)}_hasReadPermissions(t){return this.options.ignorePermissionErrors?!0:!!(Number(t.mode)&256)}_remove(t,e,n){let s=u.join(t,e),o=u.resolve(s);if(n=n??(this._watched.has(s)||this._watched.has(o)),!this._throttle("remove",s,100))return;!n&&this._watched.size===1&&this.add(t,e,!0),this._getWatchedDir(s).getChildren().forEach(l=>this._remove(s,l));let r=this._getWatchedDir(t),d=r.has(e);r.remove(e),this._symlinkPaths.has(o)&&this._symlinkPaths.delete(o);let f=s;if(this.options.cwd&&(f=u.relative(this.options.cwd,s)),this.options.awaitWriteFinish&&this._pendingWrites.has(f)&&this._pendingWrites.get(f).cancelWait()===E.ADD)return;this._watched.delete(s),this._watched.delete(o);let h=n?E.UNLINK_DIR:E.UNLINK;d&&!this._isIgnored(s)&&this._emit(h,s),this._closePath(s)}_closePath(t){this._closeFile(t);let e=u.dirname(t);this._getWatchedDir(e).remove(u.basename(t))}_closeFile(t){let e=this._closers.get(t);e&&(e.forEach(n=>n()),this._closers.delete(t))}_addPathCloser(t,e){if(!e)return;let n=this._closers.get(t);n||(n=[],this._closers.set(t,n)),n.push(e)}_readdirp(t,e){if(this.closed)return;let n={type:E.ALL,alwaysStat:!0,lstat:!0,...e,depth:0},s=yt(t,n);return this._streams.add(s),s.once(bt,()=>{s=void 0}),s.once(rt,()=>{s&&(this._streams.delete(s),s=void 0)}),s}};function Me(i,t={}){let e=new K(t);return e.add(i),e}var St={watch:Me,FSWatcher:K};import{pathToFileURL as Be,fileURLToPath as Ke}from"node:url";import{join as R,sep as Ze,dirname as qe}from"node:path";import{copyFile as Q,readFile as Je,writeFile as Ht}from"node:fs/promises";import{access as Le}from"node:fs/promises";import{constants as ke}from"node:fs";async function F(i){try{return await Le(i,ke.F_OK),!0}catch{return!1}}import{access as je}from"node:fs/promises";import{constants as Oe}from"node:fs";async function Z(i){try{return await je(i,Oe.F_OK),!0}catch{return!1}}import{join as $}from"node:path";import{readdir as ze}from"node:fs/promises";async function q(i){let t=[];try{let e=await ze(i,{withFileTypes:!0});for(let n of e)n.isDirectory()&&t.push(n.name)}catch(e){console.error("Error reading directory:",e)}return t}import{readFile as Nt}from"node:fs/promises";function J(i){return i&&i.charAt(0).toUpperCase()+i.slice(1)}function X(i){return i.replace(/([a-zA-Z])(?=[A-Z])/g,"$1-").toLowerCase()}var ft=i=>`\x1B[31m${i}\x1B[0m`,Ns=process.cwd();var M="src",S="components";function Wt(i){return{name:"playground-plugin",setup(t){let e="playground-entry",n="playground-module";t.onResolve({filter:new RegExp(`^${e}$`)},s=>({path:e,namespace:n})),t.onLoad({filter:/.*/,namespace:n},async s=>{let o=[],c=await q($(M,S));c.length===0&&(console.log(ft('Missing at least 1 namespace folder under "src/components/"')),process.exit());let a=[];for(let r of c){let d={namespace:r,components:[]};a.push(d);let f=$(M,S,r),h=await q(f);for(let l of h)if(await F($(M,S,r,l,`${l}.ts`))){let p="";await F($(M,S,r,l,"README.md"))&&(p=await Nt($(M,S,r,l,"README.md"),"utf8"));let _={namespace:r,component:l,tag:`${r}-${X(l)}`,examples:[],className:"",classExtends:"",readme:p};if(o.push(`import '${S}/${r}/${l}/${l}';`),await Z($(f,l,"__examples__"))){let g=await q($(f,l,"__examples__"));for(let w of g)await F($(f,l,"__examples__",w,`${w}.ts`))?(o.push(`import '${S}/${r}/${l}/__examples__/${w}/${w}';`),_.examples.push({namespace:r,component:l,example:w,tag:`x-${r}-${X(l)}-${X(w)}`,className:`X${J(r)}${J(l)}${J(w)}`})):console.log(ft(`Missing ${S}/${r}/${l}/__examples__/${w}/${w}.ts`))}let x=(await Nt($(M,S,r,l,`${l}.ts`),"utf8")).match(/class (\w+) extends (\w+)/);x||(console.log(ft(`Component "${r}-${l}" must extend HtmlElement or base class`)),process.exit()),_.className=x[1],_.classExtends=x[2],d.components.push(_)}}return i.after(a),{contents:o.join(`
`),resolveDir:$(process.cwd(),M)}})}}}import{sep as Lt}from"node:path";import{readFile as He}from"node:fs/promises";function Mt(i){return i.replace(/-([a-z])/g,t=>t[1].toUpperCase())}var Ye=process.cwd(),Ue=Ye.split(Lt).length,kt={name:"html-dependents-plugin",setup(i){i.onLoad({filter:/\.html$/},async t=>{let e=t.path.split(Lt).splice(Ue),[n,s,o,c,...a]=e,r=await He(t.path,"utf8"),d=r.matchAll(/<\/(?<namespace>\w+)-(?<value>[^>]+)/g),f=new Map;for(let l of d){let{namespace:p,value:_}=l.groups,P=Mt(_);f.set(`${p}-${P}`,[p,P])}let h=[];return f.forEach(([l,p])=>{let _=e.length-4,P=new Array(_).fill("..");if(l===o){if(p===c)return;h.push(`import './${P.join("/")}/${p}/${p}';`)}else h.push(`import './${P.join("/")}/${l}/${p}/${p}';`)}),h.push(`export default \`${r}\`;`),{contents:h.join(`
`),loader:"js"}})}};var Ge=i=>`\x1B[32m${i}\x1B[0m`,jt={name:"rebuild-notify",setup(i){i.onEnd(t=>{t.errors.length>0?console.error(`Build ended with ${t.errors.length} errors`):console.log(Ge("Build succeeded!"))})}};import{join as dt}from"node:path";import{readFile as Ot}from"node:fs/promises";async function zt({mode:i,rootDir:t,srcDir:e,indexFile:n,defaultDir:s,playgroundFile:o,title:c,repo:a,repoComponent:r,navigation:d,namespaces:f}){let h="";await F(dt(t,e,n))?h=await Ot(dt(t,e,n),"utf8"):h=await Ot(dt(s,o),"utf8"),h=h.replace("<title>Default</title>",`<title>${c??"Default"}</title>`),h=h.replace("<h1>Default</h1>",`<h1>${c??"Default"}</h1>`);let l=structuredClone(d??[]);for(let x of l)x.items=[];let p;l.length===0?(p={label:"Components",items:[]},l.push(p)):(p=l.find(x=>!x.extends&&!x.components&&!x.namespaces),p||(p={label:"Other",items:[]},l.push(p)));let _=new Map;if(f.forEach(({components:x})=>{x.forEach(({component:g,namespace:w,tag:b,readme:v,examples:N,className:I,classExtends:L})=>{_.set(I,{className:I,classExtends:L,component:g,namespace:w,tag:b,readme:v,examples:N.map(m=>m.className)}),N.forEach(m=>{_.set(m.className,{className:m.className,classExtends:m.classExtends,component:m.component,namespace:m.namespace,tag:m.tag,example:m.example})});for(let m of l)if(m.include&&m.include.includes(I)){m.items.push({namespace:w,component:g,className:I,tag:b});return}for(let m of l)if(m!==p&&!(m.exclude&&m.exclude.includes(I))&&!(m.namespaces&&!m.namespaces.includes(w))&&!(m.extends&&!m.extends.includes(L))){m.items.push({namespace:w,component:g,className:I,tag:b});return}p.items.push({namespace:w,component:g,examples:N,className:I,tag:b})})}),h=h.replace(/([ ]*)<!-- \[Navigation\] -->/,(x,g)=>l.map(({label:w,items:b})=>[g,`<div>${w}</div>`,"<ul>",b.map(({component:v,namespace:N,tag:I,className:L})=>[`<li data-tag="${I}" data-class-name="${L}" data-component="${v}"><a href="#${I}">${v}</a></li>`].join(`
${g}`)).join(`
${g}`),"</ul>"].join(`
${g}`)).join(`
${g}`)),a){let w=a.includes("github.com")?"M12,2A10,10 0 0,0 2,12C2,16.42 4.87,20.17 8.84,21.5C9.34,21.58 9.5,21.27 9.5,21C9.5,20.77 9.5,20.14 9.5,19.31C6.73,19.91 6.14,17.97 6.14,17.97C5.68,16.81 5.03,16.5 5.03,16.5C4.12,15.88 5.1,15.9 5.1,15.9C6.1,15.97 6.63,16.93 6.63,16.93C7.5,18.45 8.97,18 9.54,17.76C9.63,17.11 9.89,16.67 10.17,16.42C7.95,16.17 5.62,15.31 5.62,11.5C5.62,10.39 6,9.5 6.65,8.79C6.55,8.54 6.2,7.5 6.75,6.15C6.75,6.15 7.59,5.88 9.5,7.17C10.29,6.95 11.15,6.84 12,6.84C12.85,6.84 13.71,6.95 14.5,7.17C16.41,5.88 17.25,6.15 17.25,6.15C17.8,7.5 17.45,8.54 17.35,8.79C18,9.5 18.38,10.39 18.38,11.5C18.38,15.32 16.04,16.16 13.81,16.41C14.17,16.72 14.5,17.33 14.5,18.26C14.5,19.6 14.5,20.68 14.5,21C14.5,21.27 14.66,21.59 15.17,21.5C19.14,20.16 22,16.42 22,12A10,10 0 0,0 12,2Z":"M6,2H18A2,2 0 0,1 20,4V20A2,2 0 0,1 18,22H6A2,2 0 0,1 4,20V4A2,2 0 0,1 6,2M12.75,13.5C15.5,13.5 16.24,11.47 16.43,10.4C17.34,10.11 18,9.26 18,8.25C18,7 17,6 15.75,6C14.5,6 13.5,7 13.5,8.25C13.5,9.19 14.07,10 14.89,10.33C14.67,11 14,12 12,12C10.62,12 9.66,12.35 9,12.84V8.87C9.87,8.56 10.5,7.73 10.5,6.75C10.5,5.5 9.5,4.5 8.25,4.5C7,4.5 6,5.5 6,6.75C6,7.73 6.63,8.56 7.5,8.87V15.13C6.63,15.44 6,16.27 6,17.25C6,18.5 7,19.5 8.25,19.5C9.5,19.5 10.5,18.5 10.5,17.25C10.5,16.32 9.94,15.5 9.13,15.18C9.41,14.5 10.23,13.5 12.75,13.5M8.25,16.5A0.75,0.75 0 0,1 9,17.25A0.75,0.75 0 0,1 8.25,18A0.75,0.75 0 0,1 7.5,17.25A0.75,0.75 0 0,1 8.25,16.5M8.25,6A0.75,0.75 0 0,1 9,6.75A0.75,0.75 0 0,1 8.25,7.5A0.75,0.75 0 0,1 7.5,6.75A0.75,0.75 0 0,1 8.25,6M15.75,7.5A0.75,0.75 0 0,1 16.5,8.25A0.75,0.75 0 0,1 15.75,9A0.75,0.75 0 0,1 15,8.25A0.75,0.75 0 0,1 15.75,7.5Z";h=h.replace(/([ ]*)<!-- \[Repo\] -->/,(b,v)=>[v,`<a href="${a}">`,'  <svg viewBox="0 0 24 24">',`    <path fill="currentColor" d="${w}" />`,"  </svg>","  <span>View Repo</span>","</a>"].join(`
${v}`)),h=h.replace(/const repo = '';/,b=>`const repo = '${a}';`),h=h.replace(/const repoComponent = '';/,b=>`const repoComponent = '${r.replace(/\$repo/g,a)}';`),h=h.replace(/const repoIcon = '';/,b=>`const repoIcon = '${w}';`)}i==="dev"&&(h=h.replace(/([ ]*)<!-- \[info\] -->/,(x,g)=>[g,"<p>This page is generated from <code>npm start</code>. To render only specific components use <code>npm start c-button</code>.</p>"].join(`
${g}`)));let P=[..._.keys()];return h=h.replace(/([ ]*)const componentMap = new Map\(\);/,(x,g)=>[`${g}const componentMap = new Map();`,...P.map(w=>{let b=_.get(w);return`componentMap.set('${w}', ${JSON.stringify(b)});`})].join(`${g}
`)),h=h.replace(/([ ]*)const navigation = \[\];/,(x,g)=>`${g}const navigation = ${JSON.stringify(l,null,"  ")};`),h}(async()=>{let i=[kt,jt],t=m=>`\x1B[1m${m}\x1B[0m`,e=m=>`\x1B[32m${m}\x1B[0m`,n=m=>`\x1B[31m${m}\x1B[0m`,s=Ke(import.meta.url),o=qe(s),c=R(o,"..","default"),a="element.config.ts",r=process.cwd(),d="publish",f=Be(a);await F(a)||(console.log(n("Missing element.config.ts in root."),"Add with content:"),console.log("export default {"),console.log("  namespace: 'hello',"),console.log("}"),process.exit());let h=await import(f.href),{namespace:l,title:p,navigation:_,repo:P,repoComponent:x}=h.default,g="dist",w="src",b="components",v=[];if(l){console.log(e("Building app...")),v.push(`./${w}/${b}/${l}/app/app.ts`);let m="index.html";if(await F(R(r,w,m)))await Q(R(r,w,m),R(r,g,m));else{let D=await Je(R(c,m),"utf8");D=D.replace("<title>Default</title>",`<title>${p??"Default"}</title>`),D=D.replace("<namespace-app></namespace-app>",`<${l}-app></${l}-app>`),await Ht(R(r,g,m),D)}let A="favicon.svg";await F(R(r,w,A))?await Q(R(r,w,A),R(r,g,A)):await Q(R(c,A),R(r,g,A))}else{console.log(e("Building components...")),await Z(R(w,b))||(console.log(n('Missing required "src/components" directory.')),process.exit());let m="playground.html",A="index.html";v.push("playground-entry"),i.push(Wt({after:async D=>{let Yt=await zt({mode:"dev",rootDir:r,srcDir:w,indexFile:A,defaultDir:c,playgroundFile:m,title:p,repo:P,repoComponent:x,navigation:_,namespaces:D});await Ht(R(r,g,A),Yt)}}))}let N=await Ve({entryPoints:v,outfile:`./${g}/main.js`,bundle:!0,format:"esm",target:"es2024",sourcemap:!0,minify:!1,loader:{".css":"text"},plugins:i});await N.rebuild(),St.watch("src",{ignoreInitial:!0}).on("all",async(m,A)=>{if(!l){let D=A.split(Ze);D.length>4&&D[0]===w&&D[1]===b&&(console.log(`Copy "${D.slice(2).join("/")}" to publish/*`),await Q(R(r,...D),R(r,d,...D.slice(2))))}try{await N.rebuild()}catch(D){console.error("Rebuild failed:",D)}});let{port:L}=await N.serve({servedir:g});console.log(e("Dev server started at"),`localhost:${L}`)})();
/*! Bundled license information:

chokidar/index.js:
  (*! chokidar - MIT License (c) 2012 Paul Miller (paulmillr.com) *)
*/
